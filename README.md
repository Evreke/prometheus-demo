# Как пользоваться репозиторием

Вся функциональность разбита по веткам.

1. [Добавление Prometheus](https://github.com/Evreke/prometheus-hello/tree/feature/prometheus-added)

## Prometheus hello world
Демонстрация prometheus для сбора метрик с postgresql

# Prometheus

Файл prometheus.yml содержит простую конфигурацию для Prometheus.

| Параметр        | Назначение                                                                                                                  |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------|
| scrape_interval | Как часто прометей будет забирать (скрапить) метрики с хостов                                                               |
| scrape_timeout  | Если скрапинг не завершится за время заданное в этом параметре, тогда случится timeout                                      |
| external_labels | Список меток и значений присваемых временным рядам при взаимодействии с Prometheus (remote storage, alertmanager, federation) |
| scrape_configs  | Конфигурация задач на сбор метрик с экспортеров или с помощью федерации                                                     |

В данной конфигурации Prometheus каждые 15 секунд будет собирать собственные метрики и метрики postgres отдаваемые через postgres_exporter

# Для наглядности

## Генерация синтетических метрик

1. Запусти сервисы командой docker-compose up -d
2. Подключись к веб-интерфейсу прометея по адресу http://localhost:9090/graph
3. Найди метрики с помощью запроса pg_stat_user_tables_n_live_tup{relname="first_table"}. Метрика должна показать, что таблица first_table содержит 100k строк.
4. Запусти скрипт delete.sh, подожди 15 секунд и проверь метрики ещё раз. Шкала должна устремиться вниз и показывать, что в таблице 0 записей.
5. Запусти скрипт create.sh и шкала покажет, что в таблицу добавлено 100k записей.